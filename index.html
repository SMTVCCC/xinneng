<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Particle Earth</title>
    <style>
        /* 基础样式 */
        body {
            margin: 0;
            overflow: hidden;
            background: #0a0a14;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            perspective: 1000px;
        }

        /* 地球容器 */
        #earth-container {
            position: relative;
            width: 600px;
            height: 600px;
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }

        /* 地球主体 */
        #earth {
            width: 100%;
            height: 100%;
            background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Earth_Western_Hemisphere_transparent_background.png/600px-Earth_Western_Hemisphere_transparent_background.png');
            border-radius: 50%;
            background-size: cover;
            box-shadow: 0 0 40px rgba(0, 150, 255, 0.3);
            position: relative;
            cursor: grab;
        }

        /* 粒子样式 */
        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: radial-gradient(circle, #ff4d4d 0%, #ff0000 70%, #cc0000 100%);
            border-radius: 50%;
            pointer-events: none;
            animation: explode 1.5s ease-out forwards;
        }

        /* 帧率显示 */
        #fps {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: Arial;
        }
    </style>
</head>
<body>
    <div id="fps">FPS: 60</div>
    <div id="earth-container">
        <div id="earth"></div>
    </div>

    <script>
        // 初始化参数
        let isDragging = false;
        let startX, startY, startRotation = [0, 0, 0];
        let scale = 1;
        let isPerformanceMode = false;
        const particleCount = 500;
        const particles = [];

        // 获取元素
        const earth = document.getElementById('earth');
        const container = document.getElementById('earth-container');
        const fpsDisplay = document.getElementById('fps');

        // 帧率计算
        let frameCount = 0, lastTime = performance.now();
        function calculateFPS() {
            const now = performance.now();
            frameCount++;
            if (now - lastTime >= 1000) {
                fpsDisplay.textContent = `FPS: ${Math.round(frameCount)}`;
                frameCount = 0;
                lastTime = now;
            }
            requestAnimationFrame(calculateFPS);
        }
        calculateFPS();

        // 地球旋转控制
        function handleMouseDown(e) {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            startRotation = [...earth.style.transform.matchAll(/rotateX$(-?\d+)deg$/g) || []]
                .map(m => parseFloat(m[1] || 0))
                .concat([...earth.style.transform.matchAll(/rotateY$(-?\d+)deg$/g) || []]
                    .map(m => parseFloat(m[1] || 0)));
        }

        function handleMouseMove(e) {
            if (!isDragging) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            earth.style.transform = `rotateX(${startRotation[0] - dy}deg) rotateY(${startRotation[1] + dx}deg)`;
        }

        function handleMouseUp() {
            isDragging = false;
        }

        // 缩放控制
        function handleWheel(e) {
            e.preventDefault();
            const delta = Math.sign(e.deltaY) * 0.1;
            scale = Math.max(0.5, Math.min(3, scale + delta));
            container.style.transform = `scale(${scale})`;
        }

        // 粒子系统
        function createParticles() {
            particles.length = 0;
            for(let i=0; i<particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = `${Math.random()*100}%`;
                particle.style.top = `${Math.random()*100}%`;
                particle.style.transformOrigin = 'center bottom';
                particle.style.animationDelay = `-${Math.random()*2}s`;
                container.appendChild(particle);
                particles.push(particle);
            }
        }

        // 性能测试模式
        function togglePerformanceMode() {
            isPerformanceMode = !isPerformanceMode;
            if(isPerformanceMode) {
                earth.style.pointerEvents = 'none';
                container.style.cursor = 'default';
                createParticles();
                particles.forEach(p => {
                    p.addEventListener('animationend', () => p.remove());
                });
            } else {
                earth.style.pointerEvents = 'grab';
                container.style.cursor = 'grab';
            }
        }

        // 事件绑定
        earth.addEventListener('mousedown', handleMouseDown);
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
        container.addEventListener('wheel', handleWheel);
        earth.addEventListener('click', togglePerformanceMode);

        // 初始化
        calculateFPS();
    </script>
</body>
</html>